<!doctype html><html lang=zh-cn>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>CSharp查缺补漏20210928 | 泽梅尔的驻留地</title>
<meta property="og:title" content="CSharp查缺补漏20210928 - 泽梅尔的驻留地">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-28T15:52:28+08:00">
<meta property="article:modified_time" content="2021-09-28T15:52:28+08:00">
<meta name=Keywords content="csharp,unity,游戏开发,手游,单机,博客,lua,typescript">
<meta name=description content="CSharp查缺补漏20210928">
<meta name=author content="ZemelLing">
<meta property="og:url" content="https://www.zling.site/post/CSharp%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F20210928/">
<link rel="shortcut icon" href=/favicon.ico type=image/x-icon>
<link rel=stylesheet href=/css/normalize.css>
<link rel=stylesheet href=/css/style.css>
<script type=text/javascript src=//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<link href=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css rel=stylesheet>
<link rel=stylesheet href=/css/douban.css>
<link rel=stylesheet href=/css/other.css>
</head>
<body>
<header id=header class=clearfix>
<div class=container>
<div class=social-links>
<a href=https://github.com/zemelling target=_blank class="iconfont icon-github" title=github></a>
</div>
<div class=col-group>
<div class=site-name>
<a id=logo href=https://www.zling.site>
泽梅尔的驻留地
</a>
<p class=description>专注于游戏开发</p>
</div>
<div>
<nav id=nav-menu class=clearfix>
<a class=current href=https://www.zling.site>首页</a>
<a href=https://www.zling.site/archives/ title=归档>归档</a>
<a href=https://www.zling.site/about/ title=关于>关于</a>
</nav>
</div>
</div>
</div>
</header>
<div id=body>
<div class=container>
<div class=col-group>
<div class=col-8 id=main>
<div class=res-cons>
<style type=text/css>.post-toc{position:fixed;width:200px;margin-left:-210px;padding:5px 10px;font-family:Athelas,STHeiti,Microsoft Yahei,serif;font-size:12px;border:1px solid rgba(0,0,0,7%);border-radius:5px;background-color:rgba(255,255,255,.98);background-clip:padding-box;-webkit-box-shadow:1px 1px 2px rgba(0,0,0,.125);box-shadow:1px 1px 2px rgba(0,0,0,.125);word-wrap:break-word;white-space:nowrap;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:999;cursor:pointer;max-height:70%;overflow-y:auto;overflow-x:hidden}.post-toc .post-toc-title{width:100%;margin:0 auto;font-size:20px;font-weight:400;text-transform:uppercase;text-align:center}.post-toc .post-toc-content{font-size:15px}.post-toc .post-toc-content>nav>ul{margin:10px 0}.post-toc .post-toc-content ul{padding-left:20px;list-style:square;margin:.5em;line-height:1.8em}.post-toc .post-toc-content ul ul{padding-left:15px;display:none}@media print,screen and (max-width:1057px){.post-toc{display:none}}</style>
<div class=post-toc style=position:absolute;top:188px>
<h2 class=post-toc-title>文章目录</h2>
<div class=post-toc-content>
<nav id=TableOfContents>
<ul>
<li><a href=#c-70-特性>c# 7.0 特性</a>
<ul>
<li><a href=#数字字面量的改进>数字字面量的改进</a></li>
<li><a href=#解构器>解构器</a></li>
</ul>
</li>
<li><a href=#类>类</a>
<ul>
<li><a href=#重载构造器>重载构造器</a></li>
<li><a href=#参量>参量</a></li>
<li><a href=#静态构造器>静态构造器</a></li>
<li><a href=#静态构造器和字段初始化顺序>静态构造器和字段初始化顺序</a></li>
</ul>
</li>
<li><a href=#继承>继承</a>
<ul>
<li><a href=#new和重写的区别>new和重写的区别</a></li>
<li><a href=#构造器和继承>构造器和继承</a></li>
</ul>
</li>
<li><a href=#object类型>Object类型</a>
<ul>
<li><a href=#装箱和拆箱的缺点>装箱和拆箱的缺点</a></li>
<li><a href=#gettype和typeof>GetType和typeof</a></li>
</ul>
</li>
<li><a href=#结构体>结构体</a>
<ul>
<li><a href=#结构体的构造语义>结构体的构造语义</a></li>
<li><a href=#其他>其他</a></li>
</ul>
</li>
<li><a href=#可访问性>可访问性</a>
<ul>
<li><a href=#友元程序集>友元程序集</a></li>
</ul>
</li>
<li><a href=#接口>接口</a>
<ul>
<li><a href=#在子类中重新实现接口>在子类中重新实现接口</a></li>
<li><a href=#接口重新实现的替代方法>接口重新实现的替代方法</a></li>
<li><a href=#接口与装箱>接口与装箱</a></li>
</ul>
</li>
<li><a href=#泛型>泛型</a>
<ul>
<li><a href=#泛型约束>泛型约束</a></li>
<li><a href=#协变>协变</a></li>
<li><a href=#逆变>逆变</a></li>
</ul>
</li>
<li><a href=#委托>委托</a>
<ul>
<li><a href=#实例目标方法和静态目标方法>实例目标方法和静态目标方法</a></li>
<li><a href=#委托与接口>委托与接口</a></li>
<li><a href=#泛型委托类型的参数协变>泛型委托类型的参数协变</a></li>
</ul>
</li>
<li><a href=#lambda表达式>Lambda表达式</a>
<ul>
<li><a href=#局部方法和lambda的比较>局部方法和Lambda的比较</a></li>
</ul>
</li>
<li><a href=#可枚举类型和迭代器>可枚举类型和迭代器</a>
<ul>
<li><a href=#迭代器语义>迭代器语义</a></li>
</ul>
</li>
<li><a href=#匿名类型>匿名类型</a></li>
<li><a href=#元组>元组</a></li>
<li><a href=#字符串>字符串</a>
<ul>
<li><a href=#比较>比较</a></li>
</ul>
</li>
<li><a href=#相等比较>相等比较</a>
<ul>
<li><a href=#值相等和引用相等>值相等和引用相等</a></li>
</ul>
</li>
<li><a href=#销毁对象和垃圾回收>销毁对象和垃圾回收</a>
<ul>
<li><a href=#销毁的语义>销毁的语义</a></li>
<li><a href=#三种不适合销毁对象的情况>三种不适合销毁对象的情况</a></li>
<li><a href=#垃圾回收>垃圾回收</a></li>
</ul>
</li>
<li><a href=#线程>线程</a></li>
<li><a href=#阅读书本>阅读书本</a></li>
</ul>
</nav>
</div>
</div>
<script type=text/javascript>$(document).ready(function(){var a=$(".post-toc"),b,c,d;a.length&&(b=$("#main").offset().left,b<220&&a.css({width:b-10,"margin-left":0-b}),c=a.offset().top-20,d={start:{position:"absolute",top:c},process:{position:"fixed",top:20}},$(window).scroll(function(){var b=$(window).scrollTop();b<c?a.css(d.start):a.css(d.process)}))})</script>
<article class=post>
<header>
<h1 class=post-title>CSharp查缺补漏20210928</h1>
</header>
<date class="post-meta meta-date">
2021年9月28日
</date>
<div class=post-meta>
<span>|</span>
<span class=meta-category><a href=/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80>编程语言</a></span>
</div>
<div class=post-meta>
<span id=busuanzi_container_page_pv>|<span id=busuanzi_value_page_pv></span><span>
阅读</span></span>
</div>
<div class=clear style=display:none>
<div class=toc-article>
<div class=toc-title>文章目录</div>
</div>
</div>
<div class=post-content>
<h2 id=c-70-特性>c# 7.0 特性</h2>
<h3 id=数字字面量的改进>数字字面量的改进</h3>
<p>数字字面量可以使用下划线来改善可读性、它们称为数字分隔符而被编译器忽略</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C# data-lang=C#><span style=color:#458;font-weight:700>int</span> million = <span style=color:#099>1_000_000</span>;

<span style=color:#458;font-weight:700>var</span> b = <span style=color:#099>0</span>b1010_1011_1100_1101_1110_1111; <span style=color:#998;font-style:italic>// 二进制字面量可以使用0b前缀进行标识
</span></code></pre></td></tr></table>
</div>
</div><h3 id=解构器>解构器</h3>
<p>解构方法的名字必须为Deconstruct，并且拥有一个或多个out参数</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Rectangle</span>
{
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>readonly</span> <span style=color:#458;font-weight:700>float</span> Width, Height;
    <span style=color:#000;font-weight:700>public</span> Rectangle(<span style=color:#458;font-weight:700>float</span> width, <span style=color:#458;font-weight:700>float</span> height)
    {
        Width = width;
        Height = height;
    }

    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>void</span> Deconstruct(<span style=color:#000;font-weight:700>out</span> <span style=color:#458;font-weight:700>float</span> width, <span style=color:#000;font-weight:700>out</span> <span style=color:#458;font-weight:700>float</span> height)
    {
        width = Width;
        height = Height;
    }
}
</code></pre></td></tr></table>
</div>
</div><p>若要调用解构器，则需使用如下的特殊语法</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#>
<span style=color:#458;font-weight:700>var</span> rect = <span style=color:#000;font-weight:700>new</span> Rectangle(<span style=color:#099>3</span>, <span style=color:#099>4</span>);
(<span style=color:#458;font-weight:700>float</span> width, <span style=color:#458;font-weight:700>float</span> height) = rect; <span style=color:#998;font-style:italic>// width = 3, height = 4
</span><span style=color:#998;font-style:italic></span>(<span style=color:#458;font-weight:700>var</span> w, <span style=color:#458;font-weight:700>var</span> h) = rect; <span style=color:#998;font-style:italic>// 解构器支持隐式推断
</span><span style=color:#998;font-style:italic></span>
</code></pre></td></tr></table>
</div>
</div><h2 id=类>类</h2>
<h3 id=重载构造器>重载构造器</h3>
<p>当构造器调用另一个构造器时，被调用的构造器先执行。</p>
<h3 id=参量>参量</h3>
<p>常量是一种值永远不会改变的静态字段。常量会在编译时静态赋值，编译器会在常量使用点上直接替换该值（类似于C++的宏）。</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#458;font-weight:700>double</span> Circumference(<span style=color:#458;font-weight:700>double</span> radius)
{
    <span style=color:#000;font-weight:700>return</span> <span style=color:#099>2</span> * System.Math.PI * radius;
}

<span style=color:#998;font-style:italic>// 编译后等价于
</span><span style=color:#998;font-style:italic></span>
<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>static</span> <span style=color:#458;font-weight:700>double</span> Circumference(<span style=color:#458;font-weight:700>double</span> radius)
{
    <span style=color:#000;font-weight:700>return</span> <span style=color:#099>6.2831583071795862</span> * radius;
}
</code></pre></td></tr></table>
</div>
</div><h3 id=静态构造器>静态构造器</h3>
<p>每个类型的静态构造器只会执行一次，而不是每个实例执行一次。一个类型只能定义一个静态构造器，名称必须和类型同名，且没有参数</p>
<p>运行时将在类型使用之前调用静态构造器，以下两种行为可以触发静态构造器执行：</p>
<ul>
<li>实例化类型</li>
<li>访问类型的静态成员</li>
</ul>
<p>静态构造器只支持两个修饰符：unsafe和extern</p>
<h3 id=静态构造器和字段初始化顺序>静态构造器和字段初始化顺序</h3>
<p>静态字段初始化器会在调用静态构造器前运行。如果类型没有静态构造器，字段会在类型被使用之前或者在运行时中更早的时间进行初始化。</p>
<p>静态字段初始化器按照字段声明的先后顺序运行。</p>
<h2 id=继承>继承</h2>
<h3 id=new和重写的区别>new和重写的区别</h3>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>BaseClass</span>
{
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>virtual</span> <span style=color:#000;font-weight:700>void</span> Foo() {Console.WriteLine(<span style=color:#d14>&#34;BaseClass.Foo&#34;</span>);}
}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Overrider</span> : BaseClass
{
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>override</span> <span style=color:#000;font-weight:700>void</span> Foo() {Console.WriteLine(<span style=color:#d14>&#34;Overrider.Foo&#34;</span>);}
}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>Hider</span> : BaseClass
{
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>new</span> <span style=color:#000;font-weight:700>void</span> Foo() {Console.WriteLine(<span style=color:#d14>&#34;Hider.Foo&#34;</span>);}
}

<span style=color:#998;font-style:italic>// test
</span><span style=color:#998;font-style:italic></span>Overrider over = <span style=color:#000;font-weight:700>new</span> Overrider();
BaseClass b1 = over;
over.Foo();    <span style=color:#998;font-style:italic>// Overrider.Foo
</span><span style=color:#998;font-style:italic></span>b1.Foo();     <span style=color:#998;font-style:italic>// Overrider.Foo
</span><span style=color:#998;font-style:italic></span>
Hider h = <span style=color:#000;font-weight:700>new</span> Hider();
BaseClass b2 = h;
h.Foo();    <span style=color:#998;font-style:italic>// Hider.Foo
</span><span style=color:#998;font-style:italic></span>b2.Foo();    <span style=color:#998;font-style:italic>// BaseClass.Foo
</span></code></pre></td></tr></table>
</div>
</div><h3 id=构造器和继承>构造器和继承</h3>
<p>子类必须声明自己的构造器。派生类可以访问基类的构造器，但是并非自动继承。</p>
<p>基类的构造器总是先执行，这保证了基类的初始化发生在子类特定的初始化之前。</p>
<p>如果子类的构造器省略base关键字，那么基类的无参数构造器将被隐式调用。</p>
<p>如果基类没有可访问的无参数的构造器，子类的构造器中就必须使用base关键字。</p>
<h4 id=构造器和字段初始化的顺序>构造器和字段初始化的顺序</h4>
<ul>
<li>1 从子类到基类
<ul>
<li>1.1 初始化字段</li>
<li>1.2 计算被调用的基类构造器中的参数</li>
</ul>
</li>
<li>2 从基类到子类
<ul>
<li>2.1 构造器方法体的执行</li>
</ul>
</li>
</ul>
<p>例如：</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>BaseClass</span>
{
    <span style=color:#458;font-weight:700>int</span> x = <span style=color:#099>1</span>;  <span style=color:#998;font-style:italic>// 第三步
</span><span style=color:#998;font-style:italic></span>    <span style=color:#000;font-weight:700>public</span> BaseClass(<span style=color:#458;font-weight:700>int</span> x)
    {
        <span style=color:#998;font-style:italic>//something // 第四步
</span><span style=color:#998;font-style:italic></span>    }
}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>SubClass</span> : BaseClass
{
    <span style=color:#458;font-weight:700>int</span> y = <span style=color:#099>1</span>;  <span style=color:#998;font-style:italic>// 第一步
</span><span style=color:#998;font-style:italic></span>    <span style=color:#000;font-weight:700>public</span> SubClass(<span style=color:#458;font-weight:700>int</span> x) :
        <span style=color:#000;font-weight:700>base</span>(x + <span style=color:#099>1</span>) <span style=color:#998;font-style:italic>// 第二步
</span><span style=color:#998;font-style:italic></span>    {
        <span style=color:#998;font-style:italic>// something // 第五步
</span><span style=color:#998;font-style:italic></span>    }
}
</code></pre></td></tr></table>
</div>
</div><h2 id=object类型>Object类型</h2>
<h3 id=装箱和拆箱的缺点>装箱和拆箱的缺点</h3>
<ul>
<li>开销大，存在内存复制操作</li>
<li>拆箱时如果类型错误，只会在运行时发现</li>
</ul>
<h3 id=gettype和typeof>GetType和typeof</h3>
<ul>
<li>GetType在运行时计算而typeof在编译时静态计算（如果是用泛型类型参数，那么它将由即时编译器解析）</li>
</ul>
<h2 id=结构体>结构体</h2>
<h3 id=结构体的构造语义>结构体的构造语义</h3>
<ul>
<li>结构体隐式包含一个无法重写的无参数构造器，将字段按位置为0。</li>
<li>定义结构体的构造器时，必须显式为每一个字段赋值</li>
</ul>
<h3 id=其他>其他</h3>
<ul>
<li>结构体不支持字段初始化器</li>
</ul>
<h2 id=可访问性>可访问性</h2>
<h3 id=友元程序集>友元程序集</h3>
<p>在一些高级的场景中，添加System.Runtime.CompilerServices.InternalsVisibleTo程序集特性就可以将internal成员提供给其他的友元程序集访问</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:teal>[assembly:InternalsVisibleTo(&#34;Friend&#34;)]</span>
</code></pre></td></tr></table>
</div>
</div><p>如果友元程序集有强名称，必须指定其完整的160字节公钥</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:teal>[assembly:InternalsVisibleTo(&#34;StrongFriend, PublicKey=00241ffa...&#34;)]</span>

<span style=color:#998;font-style:italic>// 获取强名称程序集的公钥
</span><span style=color:#998;font-style:italic></span><span style=color:#458;font-weight:700>string</span> key = <span style=color:#458;font-weight:700>string</span>.Join(<span style=color:#d14>&#34;&#34;</span>, Assembly.GetExecutingAssembly().GetName().GetPublicKey().Select(b =&gt; b.ToString(<span style=color:#d14>&#34;x2&#34;</span>)));
</code></pre></td></tr></table>
</div>
</div><h2 id=接口>接口</h2>
<p>显式实现的接口成员不能标识为virtual，也不能实现通常意义的重写，但是它可以被重新实现（reimplemented）。</p>
<h3 id=在子类中重新实现接口>在子类中重新实现接口</h3>
<p>子类可以重新实现基类实现的任意一个接口成员。不管基类中该成员是否为virtual，当通过接口调用时，重新实现都能够劫持成员的实现。它对接口成员的隐式和显式实现都有效，但后者效果更好。</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>interface</span> IUndoable {<span style=color:#000;font-weight:700>void</span> Undo();}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>TextBox</span> : IUndoable
{
    <span style=color:#000;font-weight:700>void</span> IUndoable.Undo() =&gt; Console.WriteLine(<span style=color:#d14>&#34;TextBox.Undo&#34;</span>);
}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>RichTextBox</span> : TextBox, IUndoable
{
    <span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>void</span> Undo() =&gt; Console.WriteLine(<span style=color:#d14>&#34;RichTextBox.Undo&#34;</span>);
}

<span style=color:#998;font-style:italic>// 从接口调用重新实现的成员时，调用的是子类的实现
</span><span style=color:#998;font-style:italic></span>RichTextBox r = <span style=color:#000;font-weight:700>new</span> RichTextBox();
r.Undo();    <span style=color:#998;font-style:italic>// RichTextBox.Undo
</span><span style=color:#998;font-style:italic></span>((IUndoable)r).Undo();    <span style=color:#998;font-style:italic>// RichTextBox.Undo
</span></code></pre></td></tr></table>
</div>
</div><p>通过重新实现来劫持调用的方式仅在通过接口调用成员时有效，而从基类调用时无效。这个特性通常不尽人意，因为它有二义性。因此，重新实现主要适合于重写显式实现的接口成员</p>
<h3 id=接口重新实现的替代方法>接口重新实现的替代方法</h3>
<p>即使是显式实现的成员，接口重新实现还是容易出问题，这是因为</p>
<ul>
<li>子类无法调用基类的方法</li>
<li>定义基类时不能预测方法是否会重新实现，或无法接受重新实现后的潜在问题</li>
</ul>
<p>重新实现是子类未知时的最不理想的方法。更好的选择是在定义基类时不允许使用重新实现，有两种方法可以做到</p>
<ul>
<li>当隐式实现成员时，如果需要将其标记为virtual</li>
<li>当显式实现成员时，如果能够预测子类可能要重写某些逻辑，则使用下面的模式</li>
</ul>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>TextBox</span> : IUndoable
{
    <span style=color:#000;font-weight:700>void</span> IUndoable.Undo() =&gt; Undo();
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#000;font-weight:700>virtual</span> <span style=color:#000;font-weight:700>void</span> Undo() =&gt; Console.WriteLine(<span style=color:#d14>&#34;TextBox.Undo&#34;</span>);
}

<span style=color:#000;font-weight:700>public</span> <span style=color:#000;font-weight:700>class</span> <span style=color:#458;font-weight:700>RichTextBox</span> : TextBox
{
    <span style=color:#000;font-weight:700>protected</span> <span style=color:#000;font-weight:700>override</span> <span style=color:#000;font-weight:700>void</span> Undo() =&gt; Console.WriteLine(<span style=color:#d14>&#34;RichTextBox.Undo&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><h3 id=接口与装箱>接口与装箱</h3>
<p>将结构体转换为接口会引发装箱。而调用结构体的隐式实现接口成员不会引发装箱。</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#000;font-weight:700>interface</span> I {<span style=color:#000;font-weight:700>void</span> Foo();}
<span style=color:#000;font-weight:700>struct</span> <span style=color:#458;font-weight:700>S</span> : I {<span style=color:#000;font-weight:700>void</span> Foo();}

S s = <span style=color:#000;font-weight:700>new</span> S();
s.Foo();  <span style=color:#998;font-style:italic>// 没有装箱
</span><span style=color:#998;font-style:italic></span>
I i = s;  <span style=color:#998;font-style:italic>// 装箱
</span><span style=color:#998;font-style:italic></span>i.Foo();
</code></pre></td></tr></table>
</div>
</div><h2 id=泛型>泛型</h2>
<h3 id=泛型约束>泛型约束</h3>
<pre tabindex=0><code>where T : base-class  // 基类约束
where T : interface  // 接口约束
where T : class  // 引用类型约束
where T : struct  // 值类型约束
where T : new()  // 无参构造函数约束
where U : T  // 裸类型约束，U必须从T派生
</code></pre><h3 id=协变>协变</h3>
<p>假定A可以转换为B，如果<code>X&lt;A></code>可以转换为<code>X&lt;B></code>那么称X有一个协变类型参数。</p>
<p>数组支持协变。</p>
<p>不管是类型参数还是数组，协变（和逆变）仅仅对于引用转换有效，而对装箱转换无效。因此，如果书写了一个接受<code>IPoppable&lt;object></code>类型参数的方法，你可以使用<code>IPoppable&lt;string></code>调用它，但不能是<code>IPoppable&lt;int></code></p>
<h3 id=逆变>逆变</h3>
<p>通过前面的介绍我们已经知道，假设A可以隐式引用转换为B，如果<code>X&lt;A></code>允许引用类型转换为<code>X&lt;B></code>，则类型X具有协变类型参数。而逆变的转换方向正好相反，即从<code>X&lt;B></code>转换到<code>X&lt;A></code>。它仅在类型参数出现在输入位置上，并用in修饰符标记才行得通。</p>
<p>即使T含有相反的可变性标记，<code>Stack&lt;T></code>类可以同时实现<code>IPushable&lt;T></code>和<code>IPoppable&lt;T></code>。由于只能通过接口而不是类实现可变性，因此在进行可变性转换之前，必须首先选定IPoppable或者IPushable接口。而选定的接口会限制操作在合适的可变性规则下执行。</p>
<h2 id=委托>委托</h2>
<p>委托是不可变的，因此调用+=和-=的实质是创建一个新的委托实例，并把它赋值给已有变量</p>
<p>如果一个多播委托拥有非void的返回类型，则调用者将从最后一个触发的方法接收返回值。前面的方法仍然调用，但是返回值都会被丢弃。</p>
<p>如果委托实例指向相同的目标方法，则认为它们是等价的</p>
<p>如果多播委托按照相同的顺序引用相同的方法，则认为它们是等价的。</p>
<h3 id=实例目标方法和静态目标方法>实例目标方法和静态目标方法</h3>
<p>将一个实例方法赋值给委托对象时，后者不但要维护方法的引用，还需要维护方法所属的实例的引用。System.Delegate类的Target属性代表这个实例（如果委托引用的是一个静态方法，则该属性值为null）。</p>
<h3 id=委托与接口>委托与接口</h3>
<p>能用委托解决的问题，都可以用接口解决。</p>
<p>如果以下一个或多个条件成立，委托可能是比接口更好的选择：</p>
<ul>
<li>接口内仅定义了一个方法</li>
<li>需要多播能力</li>
<li>订阅者需要多次实现接口</li>
</ul>
<h3 id=泛型委托类型的参数协变>泛型委托类型的参数协变</h3>
<p>如果我们要定义一个泛型委托类型，那么最好参考如下的准则：</p>
<ul>
<li>将只用于返回值类型的类型参数标记为协变（out）</li>
<li>将只用于参数的任意类型参数标记为逆变（in）</li>
</ul>
<h2 id=lambda表达式>Lambda表达式</h2>
<p>Lambda表达式是一种可以替代委托实例的匿名方法。编译器会立即将Lambda表达式转换为以下两种形式之一：</p>
<ul>
<li>一个委托实例。</li>
<li>一个类型为Expression 的表达式树。该表达式树将Lambda表达式内部的代码表现为一个可遍历的对象模型，因此Lambda表达式的解释可以延迟到运行时。</li>
</ul>
<p>Lambda表达式捕获的变量会在真正调用委托时赋值，而不是在捕获时赋值。</p>
<p>捕获变量的生命周期延伸到了和委托的生命周期一致。</p>
<h3 id=局部方法和lambda的比较>局部方法和Lambda的比较</h3>
<ul>
<li>局部方法无须使用奇怪的技巧就可以实现递归（调用自己）。</li>
<li>局部方法避免了定义杂乱的委托类型。</li>
<li>局部方法的开销更小。</li>
</ul>
<h2 id=可枚举类型和迭代器>可枚举类型和迭代器</h2>
<p>迭代器是枚举器的生产者</p>
<p>yield return语句则表示“这是当前枚举器产生的下一个元素”</p>
<h3 id=迭代器语义>迭代器语义</h3>
<p>迭代器是包含一个或者多个yield语句的方法、属性或者索引器。迭代器必须返回以下四个接口之一（否则编译器会产生相应错误）：</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c# data-lang=c#><span style=color:#998;font-style:italic>// Enumerable interfaces
</span><span style=color:#998;font-style:italic></span>System.Collections.IEnumerable
System.Collections.Generic.IEnumerable&lt;T&gt;

<span style=color:#998;font-style:italic>// Enumerator interfaces 
</span><span style=color:#998;font-style:italic></span>System.Collections.IEnumerator
System.Collections.Generic.IEnumerator&lt;T&gt;
</code></pre></td></tr></table>
</div>
</div><p>yield break语句表明迭代器块不再返回更多的元素而是提前退出。</p>
<p>yield return语句不能出现在带catch子句的try语句块中, yield return语句也不能出现在catch或者finally语句块中。但是可以在只带有finally块的try语句块中使用yield语句</p>
<h2 id=匿名类型>匿名类型</h2>
<p>在同一个程序集内声明的两个匿名类型实例，如果它们的元素名称和类型是相同的，那么它们在内部就是相同的类型</p>
<h2 id=元组>元组</h2>
<p>元组是值类型，并且它是可变（可读可写）的元素</p>
<h2 id=字符串>字符串</h2>
<h3 id=比较>比较</h3>
<p>字符串比较有两种基本算法：序列比较（ordinal）和文化相关的比较（culture-sensitive）。序列比较会直接将字符串解析为数字（按照它们的Unicode字符数值）；而文化相关的比较则参照特定的字母表来解析字符。有两种特殊的文化：“当前文化”，基于计算机控制面板的设定；“不变文化”（invariant culture），在任何计算机上都是相同的（并且和美国文化密切一致）。</p>
<h2 id=相等比较>相等比较</h2>
<h3 id=值相等和引用相等>值相等和引用相等</h3>
<p>相等有两种：</p>
<ul>
<li>值相等：两个值在某种意义上是相等的。</li>
<li>引用相等：两个引用指向完全相同的对象。</li>
</ul>
<p>默认情况下：</p>
<ul>
<li>值类型使用值相等。</li>
<li>引用类型使用引用相等。</li>
</ul>
<h2 id=销毁对象和垃圾回收>销毁对象和垃圾回收</h2>
<h3 id=销毁的语义>销毁的语义</h3>
<ul>
<li>对象一旦销毁就无法再恢复，也不能够重新激活。在销毁之后继续调用其方法（除Dispose之外）或访问其属性都将抛出ObjectDisposedException。</li>
<li>可以重复调用对象的Dispose方法，且不会发生任何错误</li>
<li>若可销毁对象x“拥有”可销毁对象y，则x的Dispose方法会自动调用y的Dispose方法，接到其他指令的情况除外</li>
</ul>
<h4 id=对比close方法>对比Close方法</h4>
<p>分为以下两种情况：</p>
<ul>
<li>
<p>从功能上等价于Dispose方法</p>
</li>
<li>
<p>从功能上等价于Dispose方法</p>
</li>
</ul>
<p>第二种情形的一个示例是IDbConnection接口：关闭的连接可以重新打开；而销毁的连接则不能</p>
<h4 id=对比stop方法>对比Stop方法</h4>
<p>一些类定义了Stop方法（例如Timer和HttpListener）。Stop方法可能会释放非托管资源，但和Dispose不同的是它允许调用Start方法而重新开始。</p>
<h3 id=三种不适合销毁对象的情况>三种不适合销毁对象的情况</h3>
<ul>
<li>当你并不持有该对象，例如，当通过静态字段或者属性获得共享的对象时</li>
<li>当一个对象的Dispose方法执行了期待之外的操作时。</li>
<li>当一个对象的Dispose方法在设计上不是必需，而且释放该对象会增加程序的复杂性时。</li>
</ul>
<h3 id=垃圾回收>垃圾回收</h3>
<h4 id=根>根</h4>
<p>根有以下几种：</p>
<ul>
<li>当前正在执行的方法（或在其调用栈的任何一个方法中）的局部变量或者参数</li>
<li>静态变量</li>
<li>终结队列中的对象</li>
</ul>
<p>需要注意的是，相互循环引用的对象组在没有根引用的情况下可以回收的</p>
<h2 id=线程>线程</h2>
<p>变量自增操作不是线程安全的。</p>
<h2 id=阅读书本>阅读书本</h2>
<p><a href=https://weread.qq.com/web/reader/710327c0718f6368710b285kc81322c012c81e728d9d180>C# 7.0核心技术指南（原书第7版）</a></p>
</div>
<div class=post-archive>
<ul class=post-copyright>
<li><strong>原文作者：</strong><a rel=author href=https://www.zling.site>ZemelLing</a></li>
<li style=word-break:break-all><strong>原文链接：</strong><a href=https://www.zling.site/post/CSharp%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F20210928/>https://www.zling.site/post/CSharp%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F20210928/</a></li>
<li><strong>版权声明：</strong>本作品采用<a rel=license href=https://creativecommons.org/licenses/by-nc-nd/4.0/>知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
</ul>
</div>
<br>
<div class=post-archive>
<h2>See Also</h2>
<ul class=listing>
<li><a href=/post/%E4%BD%BF%E7%94%A8Activator%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B/>使用Activator动态创建实例</a></li>
<li><a href=/post/%E6%97%A5%E5%BF%97%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%8A%A5%E9%94%99%E7%9A%84%E9%97%AE%E9%A2%98/>日志依赖注入报错的问题</a></li>
<li><a href=/post/CSharp%E4%B8%AD%E5%8F%91%E9%80%81HTTP%E8%AF%B7%E6%B1%82%E7%9A%84%E6%96%B9%E6%B3%95/>CSharp中发送HTTP请求的方法</a></li>
<li><a href=/post/AspNetCore%E6%8E%A7%E5%88%B6%E5%99%A8%E7%9A%84Action%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E7%B1%BB%E5%9E%8B/>AspNetCore控制器的Action返回结果类型</a></li>
<li><a href=/post/CSharp%E8%B0%83%E7%94%A8%E9%9D%9E%E6%89%98%E7%AE%A1C++%E6%97%B6%E4%BD%BF%E7%94%A8%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/>CSharp调用非托管C++时使用回调函数遇到的问题</a></li>
</ul>
</div>
<div class="post-meta meta-tags">
<ul class=clearfix>
<li><a href=/tags/csharp>csharp</a></li>
</ul>
</div>
</article>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//yourdiscussshortname.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<footer id=footer>
<div>
&copy; 2021 <a href=https://www.zling.site>泽梅尔的驻留地 By ZemelLing</a>
| <a rel=nofollow target=_blank href=http://beian.miit.gov.cn/>闽ICP备2021013106号</a>
</div>
<br>
<div>
<div class=github-badge>
<a href=https://gohugo.io/ target=_black rel=nofollow><span class=badge-subject>Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
</div>
<div class=github-badge>
<a href=https://www.flysnow.org/ target=_black><span class=badge-subject>Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
</div>
<div class=github-badge>
<a href=https://github.com/flysnow-org/maupassant-hugo target=_black><span class=badge-subject>Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
</div>
</div>
</footer>
<script type=text/javascript>window.MathJax={tex2jax:{inlineMath:[['$','$']],processEscapes:!0}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script src=https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<a id=rocket href=#top></a>
<script type=text/javascript src="/js/totop.js?v=0.0.0" async></script>
<script type=text/javascript src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js async></script>
<script src=/js/douban.js></script>
</div>
<div id=secondary>
<section class=widget>
<form id=search action=https://www.zling.site/search/ method=get accept-charset=utf-8 target=_blank _lpchecked=1>
<input type=text name=q maxlength=20 placeholder=Search>
<input type=hidden name=sitesearch value=https://www.zling.site>
<button type=submit class="submit icon-search"></button>
</form>
</section>
<section class=widget>
<h3 class=widget-title>最近文章</h3>
<ul class=widget-list>
<li>
<a href=https://www.zling.site/post/ToLua%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE/ title=ToLua项目配置>ToLua项目配置</a>
</li>
<li>
<a href=https://www.zling.site/post/Lua%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/ title=Lua名词解释>Lua名词解释</a>
</li>
<li>
<a href=https://www.zling.site/post/Ubuntu%E4%B8%AD%E9%85%8D%E7%BD%AESVN%E6%9C%8D%E5%8A%A1%E5%99%A8/ title=Ubuntu中配置SVN服务器>Ubuntu中配置SVN服务器</a>
</li>
<li>
<a href=https://www.zling.site/post/Unity%E4%B8%AD%E7%9A%84UGUI/ title=Unity中的UGUI>Unity中的UGUI</a>
</li>
<li>
<a href=https://www.zling.site/post/Unity%E4%B8%AD%E7%9A%84IMGUI/ title=Unity中的IMGUI>Unity中的IMGUI</a>
</li>
<li>
<a href=https://www.zling.site/post/CSharp%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F%E4%B9%8B%E9%87%8D%E5%86%99%E5%92%8C%E8%A6%86%E7%9B%96%E7%9A%84%E5%8C%BA%E5%88%AB/ title=CSharp查缺补漏之重写(override)和覆盖(new)的区别>CSharp查缺补漏之重写(override)和覆盖(new)的区别</a>
</li>
<li>
<a href=https://www.zling.site/post/%E6%B4%97%E7%89%8C%E7%AE%97%E6%B3%95/ title=洗牌算法>洗牌算法</a>
</li>
<li>
<a href=https://www.zling.site/post/CSharp%E6%9F%A5%E7%BC%BA%E8%A1%A5%E6%BC%8F20210928/ title=CSharp查缺补漏20210928>CSharp查缺补漏20210928</a>
</li>
<li>
<a href=https://www.zling.site/post/%E4%BD%BF%E7%94%A8Activator%E5%8A%A8%E6%80%81%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B/ title=使用Activator动态创建实例>使用Activator动态创建实例</a>
</li>
<li>
<a href=https://www.zling.site/post/Unity%E4%B9%8B%E5%8A%A8%E6%80%81%E5%B0%86%E5%9C%BA%E6%99%AF%E6%B7%BB%E5%8A%A0%E5%88%B0BuildSettings%E4%B8%AD/ title=Unity之动态将场景添加到BuildSettings中>Unity之动态将场景添加到BuildSettings中</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/categories/>分类</a></h3>
<ul class=widget-list>
<li><a href=https://www.zling.site/categories/%E5%85%B6%E4%BB%96%E6%96%B9%E9%9D%A2/>其他方面 (23)</a></li>
<li><a href=https://www.zling.site/categories/%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86/>数学知识 (1)</a></li>
<li><a href=https://www.zling.site/categories/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/>游戏开发 (34)</a></li>
<li><a href=https://www.zling.site/categories/%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80/>编程基础 (11)</a></li>
<li><a href=https://www.zling.site/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/>编程语言 (12)</a></li>
<li><a href=https://www.zling.site/categories/%E8%8B%B1%E8%AF%AD%E5%AD%A6%E4%B9%A0/>英语学习 (13)</a></li>
<li><a href=https://www.zling.site/categories/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/>问题记录 (3)</a></li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title><a href=/tags/>标签</a></h3>
<div class=tagcloud>
<a href=https://www.zling.site/tags/2d/>2d</a>
<a href=https://www.zling.site/tags/mariadb/>mariadb</a>
<a href=https://www.zling.site/tags/algorithm/>algorithm</a>
<a href=https://www.zling.site/tags/android/>android</a>
<a href=https://www.zling.site/tags/artifactory/>artifactory</a>
<a href=https://www.zling.site/tags/aspnetcore/>aspnetcore</a>
<a href=https://www.zling.site/tags/assembly/>assembly</a>
<a href=https://www.zling.site/tags/assetbundle/>assetbundle</a>
<a href=https://www.zling.site/tags/attribute/>attribute</a>
<a href=https://www.zling.site/tags/bridge/>bridge</a>
<a href=https://www.zling.site/tags/c++/>c++</a>
<a href=https://www.zling.site/tags/caddy/>caddy</a>
<a href=https://www.zling.site/tags/calculus/>calculus</a>
<a href=https://www.zling.site/tags/camera/>camera</a>
<a href=https://www.zling.site/tags/certificate/>certificate</a>
<a href=https://www.zling.site/tags/component/>component</a>
<a href=https://www.zling.site/tags/compression/>compression</a>
<a href=https://www.zling.site/tags/consul/>consul</a>
<a href=https://www.zling.site/tags/csharp/>csharp</a>
<a href=https://www.zling.site/tags/data-save/>data save</a>
<a href=https://www.zling.site/tags/debian/>debian</a>
<a href=https://www.zling.site/tags/decompression/>decompression</a>
<a href=https://www.zling.site/tags/design-pattern/>design pattern</a>
<a href=https://www.zling.site/tags/docker/>docker</a>
<a href=https://www.zling.site/tags/english/>english</a>
<a href=https://www.zling.site/tags/event/>event</a>
<a href=https://www.zling.site/tags/excel/>excel</a>
<a href=https://www.zling.site/tags/facade/>facade</a>
<a href=https://www.zling.site/tags/frp/>frp</a>
<a href=https://www.zling.site/tags/game-design/>game design</a>
<a href=https://www.zling.site/tags/game-development/>game development</a>
<a href=https://www.zling.site/tags/grammar/>grammar</a>
<a href=https://www.zling.site/tags/gui/>gui</a>
<a href=https://www.zling.site/tags/http/>http</a>
<a href=https://www.zling.site/tags/hugo/>hugo</a>
<a href=https://www.zling.site/tags/io/>io</a>
<a href=https://www.zling.site/tags/jira/>jira</a>
<a href=https://www.zling.site/tags/lighting/>lighting</a>
<a href=https://www.zling.site/tags/linux/>linux</a>
<a href=https://www.zling.site/tags/log/>log</a>
<a href=https://www.zling.site/tags/lua/>lua</a>
<a href=https://www.zling.site/tags/mariadb/>mariadb</a>
<a href=https://www.zling.site/tags/markdown/>markdown</a>
<a href=https://www.zling.site/tags/math/>math</a>
<a href=https://www.zling.site/tags/mediator/>mediator</a>
<a href=https://www.zling.site/tags/mongodb/>mongodb</a>
<a href=https://www.zling.site/tags/mysql/>mysql</a>
<a href=https://www.zling.site/tags/nexus3/>nexus3</a>
<a href=https://www.zling.site/tags/nuget/>nuget</a>
<a href=https://www.zling.site/tags/phrase/>phrase</a>
<a href=https://www.zling.site/tags/problem/>problem</a>
<a href=https://www.zling.site/tags/protobuf/>protobuf</a>
<a href=https://www.zling.site/tags/redis/>redis</a>
<a href=https://www.zling.site/tags/render/>render</a>
<a href=https://www.zling.site/tags/rider/>rider</a>
<a href=https://www.zling.site/tags/scene/>scene</a>
<a href=https://www.zling.site/tags/serilog/>serilog</a>
<a href=https://www.zling.site/tags/shuffle/>shuffle</a>
<a href=https://www.zling.site/tags/sort-algorithm/>sort algorithm</a>
<a href=https://www.zling.site/tags/sprites/>sprites</a>
<a href=https://www.zling.site/tags/state/>state</a>
<a href=https://www.zling.site/tags/thread/>thread</a>
<a href=https://www.zling.site/tags/tilemap/>tilemap</a>
<a href=https://www.zling.site/tags/tolua/>tolua</a>
<a href=https://www.zling.site/tags/ubuntu/>ubuntu</a>
<a href=https://www.zling.site/tags/ugui/>ugui</a>
<a href=https://www.zling.site/tags/unity/>unity</a>
<a href=https://www.zling.site/tags/unity-api/>unity api</a>
<a href=https://www.zling.site/tags/vs/>vs</a>
<a href=https://www.zling.site/tags/web/>web</a>
<a href=https://www.zling.site/tags/xml/>xml</a>
<a href=https://www.zling.site/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/>内网穿透</a>
<a href=https://www.zling.site/tags/%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF/>渲染管线</a>
<a href=https://www.zling.site/tags/%E7%94%BB%E8%B4%A8/>画质</a>
</div>
</section>
<section class=widget>
<h3 class=widget-title>友情链接</h3>
<ul class=widget-list>
<li>
<a target=_blank href=https://www.flysnow.org/ title=飞雪无情的博客>飞雪无情的博客</a>
</li>
<li>
<a target=_blank href=http://www.hariogame.com/ title=哈里奥游戏工作室>哈里奥游戏工作室</a>
</li>
<li>
<a target=_blank href=https://siahk.github.io/ title=一位JAVA程序员>Siahk</a>
</li>
</ul>
</section>
<section class=widget>
<h3 class=widget-title>其它</h3>
<ul class=widget-list>
<li><a href=https://www.zling.site/index.xml>文章 RSS</a></li>
</ul>
</section>
</div>
</div>
</div>
</div>
</body>
</html>